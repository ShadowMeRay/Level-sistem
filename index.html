<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Level System</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: #0d0d0d;
      color: #f0f0f0;
      display: flex;
      gap: 20px;
      padding: 20px;
    }
    .panel {
      background: #1a1a1a;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0,247,255,0.2);
      flex: 1;
      max-height: 90vh;
      overflow-y: auto;
    }
    #left {
      flex: 0.7;
    }
    #center {
      flex: 1.5;
    }
    #right {
      flex: 0.7;
    }
    h2 {
      color: #00f7ff;
      text-align: center;
    }
    .btn {
      display: block;
      width: 100%;
      margin: 10px 0;
      background: #00f7ff;
      color: #111;
      border: none;
      padding: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: 0.3s;
    }
    .btn:hover {
      background: #00c2cc;
    }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      background: #2a2a2a;
      margin: 5px 0;
      padding: 10px;
      border-radius: 8px;
    }
    .xp-bar {
      background: #333;
      border-radius: 10px;
      overflow: hidden;
      margin-top: 5px;
      height: 20px;
    }
    .xp-fill {
      background: #00f7ff;
      height: 100%;
      width: 0%;
      transition: width 0.5s;
    }
  </style>
</head>
<body>

  <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å: —É—Ä–æ–≤–µ–Ω—å -->
  <div id="left" class="panel">
    <h2>–¢–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å</h2>
    <p>–£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span></p>
    <div class="xp-bar"><div id="xp-fill" class="xp-fill"></div></div>
    <p>–û–ø—ã—Ç: <span id="xp">0</span> / <span id="xp-next">100</span></p>

    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
    <ul id="recent-achievements"></ul>
    <button class="btn" onclick="showAllAchievements()">–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ</button>
    <ul id="all-achievements" style="display:none;"></ul>
  </div>

  <!-- –¶–µ–Ω—Ç—Ä: –º–∏—Å—Å–∏–∏ -->
  <div id="center" class="panel">
    <h2>üéØ –ú–∏—Å—Å–∏–∏</h2>
    <button class="btn" onclick="addMission()">–î–æ–±–∞–≤–∏—Ç—å –º–∏—Å—Å–∏—é</button>
    <ul id="missions"></ul>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å: –º–∞–≥–∞–∑–∏–Ω -->
  <div id="right" class="panel">
    <h2>üõç –ú–∞–≥–∞–∑–∏–Ω</h2>
    <p>–û—á–∫–∏: <span id="points">0</span></p>
    <button class="btn" onclick="addShopItem()">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–µ–¥–º–µ—Ç</button>
    <ul id="shop"></ul>
  </div>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDW4SQaVKDmU8kgQ1xO1IlCwKfMoACCLVY",
      authDomain: "level-sistem.firebaseapp.com",
      databaseURL: "https://level-sistem-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "level-sistem",
      storageBucket: "level-sistem.firebasestorage.app",
      messagingSenderId: "417407528186",
      appId: "1:417407528186:web:4e8d3f55fe3cf8871ced43"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let level = 1, xp = 0, xpToNext = 100, points = 0;

    const missionsEl = document.getElementById("missions");
    const achievementsRecent = document.getElementById("recent-achievements");
    const achievementsAll = document.getElementById("all-achievements");

    function updateUI() {
      document.getElementById("level").textContent = level;
      document.getElementById("xp").textContent = xp;
      document.getElementById("xp-next").textContent = xpToNext;
      document.getElementById("points").textContent = points;
      document.getElementById("xp-fill").style.width = (xp / xpToNext * 100) + "%";
    }

    function addMission() {
      const title = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –º–∏—Å—Å–∏–∏:");
      const reward = parseInt(prompt("–°–∫–æ–ª—å–∫–æ –æ–ø—ã—Ç–∞ –¥–∞—ë—Ç?"), 10);
      if (!title || isNaN(reward)) return;
      const key = db.ref("missions").push({ title, reward }).key;
    }

    function completeMission(key, reward, title) {
      xp += reward;
      if (xp >= xpToNext) {
        xp -= xpToNext;
        level++;
        points += 10; // –æ—á–∫–∏ –∑–∞ —É—Ä–æ–≤–µ–Ω—å
        xpToNext = Math.floor(xpToNext * 1.3);
      }
      db.ref("achievements").push({ title: "–í—ã–ø–æ–ª–Ω–∏–ª: " + title });
      db.ref("missions/" + key).remove();
      updateUI();
    }

    db.ref("missions").on("value", snap => {
      missionsEl.innerHTML = "";
      snap.forEach(item => {
        const m = item.val();
        const li = document.createElement("li");
        li.innerHTML = `<b>${m.title}</b> ‚Äî ${m.reward} XP 
          <button class="btn" style="margin-top:5px" 
            onclick="completeMission('${item.key}', ${m.reward}, '${m.title}')">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>`;
        missionsEl.appendChild(li);
      });
    });

    db.ref("achievements").on("value", snap => {
      achievementsRecent.innerHTML = "";
      achievementsAll.innerHTML = "";
      const items = [];
      snap.forEach(item => items.push(item.val().title));
      items.reverse();
      items.slice(0, 3).forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        achievementsRecent.appendChild(li);
      });
      items.forEach(t => {
        const li = document.createElement("li");
        li.textContent = t;
        achievementsAll.appendChild(li);
      });
    });

    function showAllAchievements() {
      achievementsAll.style.display = achievementsAll.style.display === "none" ? "block" : "none";
    }

    const shopEl = document.getElementById("shop");

    function addShopItem() {
      const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–º–µ—Ç–∞:");
      const cost = parseInt(prompt("–¶–µ–Ω–∞ –≤ –æ—á–∫–∞—Ö:"), 10);
      if (!name || isNaN(cost)) return;
      db.ref("shop").push({ name, cost });
    }

    function buyItem(key, cost, name) {
      if (points < cost) return alert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤!");
      points -= cost;
      alert("–ö—É–ø–ª–µ–Ω: " + name);
      updateUI();
    }

    db.ref("shop").on("value", snap => {
      shopEl.innerHTML = "";
      snap.forEach(item => {
        const s = item.val();
        const li = document.createElement("li");
        li.innerHTML = `<b>${s.name}</b> ‚Äî ${s.cost} –æ—á–∫–æ–≤ 
          <button class="btn" style="margin-top:5px"
            onclick="buyItem('${item.key}', ${s.cost}, '${s.name}')">–ö—É–ø–∏—Ç—å</button>`;
        shopEl.appendChild(li);
      });
    });

    updateUI();
  </script>
</body>
</html>
