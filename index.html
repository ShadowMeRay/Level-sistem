<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Миссии и магазин</title>
  <style>
    body {
      font-family: sans-serif;
      background-size: cover;
      background-position: center;
      transition: background 0.3s;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    h1 { margin-top: 0; }
    .mission, .shop-item {
      background: rgba(0,0,0,0.6);
      margin: 10px auto;
      padding: 10px;
      border-radius: 10px;
      max-width: 400px;
    }
    .buttons { display: flex; justify-content: center; gap: 10px; margin-top: 10px; }
    .settings-panel {
      position: fixed;
      top: 0; right: -300px;
      width: 300px; height: 100%;
      background: rgba(0,0,0,0.85);
      padding: 20px;
      transition: right 0.3s;
    }
    .settings-panel.open { right: 0; }
    .gear {
      position: fixed; top: 20px; right: 20px;
      font-size: 30px; cursor: pointer;
    }
    button {
      padding: 5px 10px; border: none; border-radius: 5px; cursor: pointer;
    }
    button:disabled {
      opacity: 0.5; cursor: not-allowed;
    }
  </style>
</head>
<body>

  <h1>Мои миссии</h1>
  <div id="missions"></div>

  <h1>Магазин</h1>
  <div>Монет: <span id="coins">0</span></div>
  <div id="shop"></div>

  <div class="gear">⚙️</div>
  <div class="settings-panel" id="settingsPanel">
    <h2>Настройки</h2>
    <label>Фон: <input type="file" id="backgroundUpload" accept="image/*"></label>
    <hr>
    <button id="resetProgress">Сбросить прогресс</button>
  </div>

<script>
  const missionsData = [
    { id: 1, title: "Миссия 1", img: "", done: false },
    { id: 2, title: "Миссия 2", img: "", done: false },
    { id: 3, title: "Миссия 3", img: "", done: false }
  ];
  const shopData = [
    { id: 1, name: "Товар 1", cost: 20, img: "" },
    { id: 2, name: "Товар 2", cost: 30, img: "" }
  ];

  let coins = parseInt(localStorage.getItem("coins")) || 0;
  let completed = JSON.parse(localStorage.getItem("completed")) || {};

  const missionsDiv = document.getElementById("missions");
  const shopDiv = document.getElementById("shop");
  const coinsSpan = document.getElementById("coins");

  function save() {
    localStorage.setItem("coins", coins);
    localStorage.setItem("completed", JSON.stringify(completed));
  }

  function renderMissions() {
    missionsDiv.innerHTML = "";
    missionsData.forEach(m => {
      const wrap = document.createElement("div");
      wrap.className = "mission";
      wrap.innerHTML = `
        <h3>${m.title}</h3>
        <div class="buttons">
          <button ${completed[m.id] ? "disabled" : ""} data-action="done" data-id="${m.id}">Выполнено</button>
          <button ${completed[m.id] ? "disabled" : ""} data-action="fail" data-id="${m.id}">Провал</button>
        </div>
      `;
      missionsDiv.appendChild(wrap);
    });
  }

  function renderShop() {
    shopDiv.innerHTML = "";
    shopData.forEach(s => {
      const wrap = document.createElement("div");
      wrap.className = "shop-item";
      wrap.innerHTML = `
        <h3>${s.name}</h3>
        <p>Цена: ${s.cost} монет</p>
        <button data-buy="${s.id}">Купить</button>
      `;
      shopDiv.appendChild(wrap);
    });
  }

  function updateCoins() {
    coinsSpan.textContent = coins;
    save();
  }

  document.body.addEventListener("click", e => {
    if (e.target.dataset.action === "done" && !completed[e.target.dataset.id]) {
      completed[e.target.dataset.id] = true;
      coins += 10;
      updateCoins();
      renderMissions();
    }
    if (e.target.dataset.action === "fail" && !completed[e.target.dataset.id]) {
      completed[e.target.dataset.id] = true;
      renderMissions();
    }
    if (e.target.dataset.buy) {
      const item = shopData.find(i => i.id == e.target.dataset.buy);
      if (coins >= item.cost) {
        coins -= item.cost;
        updateCoins();
        alert("Куплено: " + item.name);
      } else {
        alert("Недостаточно монет!");
      }
    }
  });

  document.querySelector(".gear").onclick = () => {
    document.getElementById("settingsPanel").classList.toggle("open");
  };

  document.getElementById("backgroundUpload").addEventListener("change", e => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = () => {
        document.body.style.backgroundImage = `url('${reader.result}')`;
        localStorage.setItem("background", reader.result);
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById("resetProgress").addEventListener("click", () => {
    if (confirm("Вы уверены, что хотите сбросить прогресс?") && confirm("Точно уверены?")) {
      localStorage.clear();
      location.reload();
    }
  });

  // при загрузке
  const savedBg = localStorage.getItem("background");
  if (savedBg) document.body.style.backgroundImage = `url('${savedBg}')`;

  renderMissions();
  renderShop();
  updateCoins();
</script>
</body>
</html>

